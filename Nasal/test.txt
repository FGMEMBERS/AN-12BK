
KM-5 from TKS compass system

Nadel zum Einstellen der Variation:

needle
instrumentation/magnetic-compass/pitch-offset-deg

Index-Marker, der die Variation anzeigt:

index
environment/magnetic-variation-deg
########################################################################
Heading indicator USH Nur Anzeigen, keine Einstellm√∂glichkeiten

instrumentation/adf/indicated-bearing-deg
instrumentation/magnetic-compass/indicated-heading-deg

needle_1
needle_2
fdm/jsbsim/instrumentation/ga3-corrected-1
    
index
fdm/jsbsim/instrumentation/ga3-corrected-2
  
needle_2
fdm/jsbsim/instrumentation/nvu/drift-angle
  
MK, GPK und AK lampen
  
  tu154/switches/pu-11-gpk  
#########################################################################
ADF/VOR indicator USHDB  Einstellen der Kompass Richtung

compass
tu154/instrumentation/ushdb/compass
  
needle_1
tu154/instrumentation/ushdb/heading-deg-1
    
needle_2
tu154/instrumentation/ushdb/heading-deg-2
  
  
Knob zum Einstellen
hs
tu154/instrumentation/ushdb/compass
#########################################################################
ARK-15 (ADF) control gauge

lamp_1
<not>tu154/switches/adf-1-selector</not>
instrumentation/adf[0]/serviceable
   
lamp_2
tu154/switches/adf-1-selector
instrumentation/adf[0]/serviceable
    
<!--operate/standby selector-->
<animation>
<type>rotate</type>
handle
tu154/switches/adf-1-selector
  
  
tu154/instrumentation/ark-15[0]/digit-2-1 
1-3 1-2 1-1 2-3 2-2 2-1
  
instrumentation/adf[0]/volume
##########################################################################



var updateRMI = func {

# Needle default 'off' or out-of-range positions:

  var needle1 = 90;
  var needle2 = 90;


# If RMI 1 set to ADF (mode 1):

  if (getprop("/instrumentation/rmi/rmi-needle[0]/switch")) {
    if (getprop("/instrumentation/adf[0]/in-range")) {
      needle1 = getprop("/instrumentation/adf[0]/indicated-bearing-deg");
    }
  }

# RMI 1 set to VOR (mode 0):

  else {
    if (getprop("/instrumentation/nav[0]/in-range")) {
      # Needle actual = needle bearing
      needle1 = indiBearingDeg(getprop("/instrumentation/nav[0]/heading-deg"),getprop("/orientation/heading-magnetic-deg")); 
    }
  }

# If RMI 2 set to ADF (mode 1):

  if (getprop("/instrumentation/rmi/rmi-needle[1]/switch")) {
    if (getprop("/instrumentation/adf[1]/in-range")) {
      needle2 = getprop("/instrumentation/adf[1]/indicated-bearing-deg");
    }
  }

# RMI 2 set to VOR (mode 0):

  else {
    if (getprop("/instrumentation/nav[1]/in-range")) {
      # Needle actual = needle bearing
      needle2 = indiBearingDeg(getprop("/instrumentation/nav[1]/heading-deg"),getprop("/orientation/heading-magnetic-deg")); 
    }
  }
  
  if(needle1 > 360) needle1 = needle1 - 360;
  if(needle2 > 360) needle2 = needle2 - 360;
  
  #screen.log.write("needle1 " ~needle1, 1.0, 0.1, 0.1);  
  #screen.log.write("needle2 " ~needle2, 1.0, 0.1, 0.1);
  
# Save Needle settings
  interpolate("/instrumentation/rmi/rmi-needle[0]/value", needle1, 1);
  interpolate("/instrumentation/rmi/rmi-needle[1]/value", needle2, 1);

# RMI updated 1 times / sec

  settimer(updateRMI, 1);
}


var adf_false_tick = func {
  setprop("/instrumentation/adf[0]/in-range", 0);
  setprop("/instrumentation/adf[1]/in-range", 0);
  settimer(adf_false_tick, 6);
}

updateRMI();
adf_false_tick();


